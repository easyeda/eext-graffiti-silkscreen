<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canvas Drawing and Upload</title>
<script>

let canvas, ctx, drawing = false, offsetX = 0, offsetY = 0;


window.onload = function() {
    canvas = document.getElementById('drawingCanvas');
    ctx = canvas.getContext('2d');
    // 设置底图为白色
    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mousemove', draw);
}

function startDrawing(e) {
    drawing = true;
    offsetX = e.clientX - canvas.offsetLeft;
    offsetY = e.clientY - canvas.offsetTop;
    ctx.beginPath();
    ctx.moveTo(offsetX, offsetY);
}

function stopDrawing() {
    drawing = false;
}

function draw(e) {
    if (!drawing) return;
    const x = e.clientX - canvas.offsetLeft;
    const y = e.clientY - canvas.offsetTop;
    ctx.lineTo(x, y);
    ctx.stroke();
}

async function uploadCanvas() {
    const dataURL = canvas.toDataURL('image/png'); // 将画布内容导出为base64编码的PNG图片
    const formData = new FormData();
    formData.append('image', dataURL.replace(/^data:image\/(png|jpg);base64,/, ''));

    try {
        const response = await fetch(`https://api.imgbb.com/1/upload?expiration=600&key=93ecff6c249ca51c6ee0fb5a4b7d7c8a`, {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        if (response.ok && data.success) {
            document.getElementById('output').innerHTML = `
                <img src="${data.data.url}" alt="Uploaded Image" />
                <p>Viewer URL: <a href="${data.data.url_viewer}" target="_blank">${data.data.url_viewer}</a></p>
                <p>Display URL: <a href="${data.data.display_url}" target="_blank">${data.data.display_url}</a></p>
                <p>Width: ${data.data.width}</p>
                <p>Height: ${data.data.height}</p>
                <p>Size: ${data.data.size}</p>
                <p>Uploaded at: ${data.data.time}</p>
                <p>Expiration: ${data.data.expiration}</p>
                <p>Delete URL: <a href="${data.data.delete_url}" target="_blank">Delete Image</a></p>
            `;
            console.log('Image uploaded successfully:', data);
        } else {
            console.error('Error:', data.error || 'Unknown error');
        }
    } catch (error) {
        console.error('Upload failed:', error);
    }
}
</script>
</head>
<body>
<h1>Canvas Drawing</h1>
<canvas id="drawingCanvas" width="500" height="500" style="border:1px solid #000;"></canvas>
<button onclick="uploadCanvas()">Upload Drawing</button>
<div id="output"></div>
</body>
</html>
